{% extends 'inventory/base.html' %}

{% load humanize %}
{% load static %}

{% block content %}
<main role="main" class="container">
  <!--Modal for selecting reduction qty-->

 <h1 class="m-4">Review Target Items</h1>
  <div class="row m-4">
    <!--No Move List-->
    <div class="col-sm">
      <h3>Target List</h3>
    </div>
    <div class="col-sm">
      <a class="btn btn-primary" href="{% url 'count-usage-list' %}">Back to No Move List</a>
    </div>
  </div>
  {% if target_list %}
  <ul id="targetlist">
    {% for item in target_list %}
    <li
      style="list-style-type: none;"
      id={{ item.id }}
    >
      <div class="card mt-3">
        <div class="card-body">
          <h5 class="card-title">{{ item.description }}</h5>
          <div class="row">
            <div class="col-sm">
              <p class="card-text">Mfr Cat No: {{ item.mfr_cat_no }}</p>
            </div>
            <div class="col-sm">
              <p class="card-text">IMMS #: {{ item.imms }}</p>
            </div>
            <div class="col-sm">
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <p class="card-text">Quantity: {{ item.count_qty|intcomma }}</p>
            </div>
            <div class="col-sm">
              <p class="card-text">
                Cost: ${{ item.wt_avg_cost|floatformat:0|intcomma }}
              </p>
            </div>
            <div class="col-sm">
              <p class="card-text">
                Ext: ${{ item.ext_cost|floatformat:0|intcomma }}
              </p>
            </div>
          </div>

          <div class="row">
            <div class="col-sm">
              <div class="form-check form-switch">
                <input class="form-check-input" checked type="checkbox" data-id={{ item.id }}>
                <label class="form-check-label" for="flexSwitchCheckDefault">Target Item</label>
              </div>
            </div>
            <div class="col-sm">
              {% if item.id in not_outstanding_ids %}
              <a class="btn btn-success" href="{% url 'move-targets' item.id %}">Set Movement Plan</a>
              {% elif item.id in outstanding_ids %}
              <a class="btn btn-warning" href="{% url 'move-targets' item.id %}">Set Movement Plan</a>
              {% else %}
              <a class="btn btn-danger" href="{% url 'move-targets' item.id %}">Set Movement Plan</a>
              {% endif %}
            </div>
            <div class="col-sm">
              {% for plan in all_plans %}
                {% if item.id == plan.item_id %}
                  {% if plan.result == 'accepted' %}
                  <p>Current Status: <mark>{{ plan.result }}</mark><br> Quantity approved: <mark>{{ plan.accepted_qty }}</mark></p>
                  {% else %}
                  <p>Current Status: <mark>{{ plan.result }}</mark></p>
                  {% endif %}
                {% endif %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </li>
    {% endfor %}
  </ul>
</main>

{% else %}
  <h4 class="mt-5">
    No items targeted yet. Go back to the no move list and start identifying items for reduction!
  </h4>
{% endif %} 
{% endblock %}

{% block extra_js %}
  <script src="{% static 'target/javascript/target.js' %}"></script>
{% endblock %}